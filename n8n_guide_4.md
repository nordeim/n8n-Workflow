## 1. Why n8n & Why JSON?

n8n (“nodemation”) is an open-source workflow automation platform. Everything you build visually in the canvas is ultimately stored as a JSON document.  
Learning to read and tweak that JSON unlocks super-powers:

* **Version control** – store workflows in Git, review diffs, PR changes.  
* **Programmatic generation** – create or mutate workflows from code/scripts.  
* **Bulk search & replace / refactoring** – e.g. update 50 webhooks in seconds.  
* **Debugging** – sometimes the UI hides an erroneous parameter that jumps out in raw JSON.

If you have ever exported a workflow (`Workflow → Download`) you’ve seen a file that looks roughly like:

```json
{
  "name": "Untitled",
  "nodes": [],
  "connections": {},
  "settings": {},
  "active": false
}
```

From this skeleton we’ll grow a production-ready automation with triggers, loops, error handling and external APIs.

---

## 2. Anatomy of an n8n Workflow JSON

High-level schema (simplified):

* **name** – human-friendly title.  
* **nodes[]** – ordered set of node objects.  
* **connections{}** – adjacency list linking node outputs → inputs.  
* **settings{}** – workflow-wide toggles (e.g., timezone, error-workflow).  
* **pinData{}** – data pinned in the UI for testing (optional).  
* **staticData{}** – runtime storage for the workflow (optional, rarely edited manually).  
* **active** – boolean flag: should the workflow execute automatically?  
* **versionId** – generated by n8n Cloud/self-host for concurrency control.

Each **node** object typically contains:

| Key | Purpose |
|-----|---------|
| **parameters** | The UI-visible fields you fill out. All runtime behaviour lives here. |
| **id** | Internal numeric ID (string in Cloud); stable per workflow. |
| **name** | Display name in the canvas. |
| **type** | Node class (e.g. `n8n-nodes-base.github`). |
| **typeVersion** | Specific version of the node constructor. |
| **position** | Canvas x/y coordinates. |
| **credentials** | Reference to saved creds. |
| **webhookId** | Only for Webhook node. |
| **notes** | Markdown comments (optional). |
| **retryOnFail, waitMaxTries, etc.** | Optional per-node settings. |

Connections are shaped as:

```json
"connections": {
  "Node A": {
    "main": [
      [
        {
          "node": "Node B",
          "type": "main",
          "index": 0
        }
      ]
    ]
  }
}
```

Multiple outputs (`0`, `1`, `2`) or branches appear as nested arrays inside `main`.

---

## 3. A Complex Yet Typical Example Workflow

Scenario:  

“At 09:00 every weekday, fetch all open GitHub issues in a repo, filter those labelled `bug`, enrich each with sentiment analysis (via OpenAI API), create a card in Trello for triage, then post a summary in Slack. Errors go to a separate Slack channel.”

This example shows:

* Schedule Trigger  
* HTTP Request (GitHub REST) with pagination  
* SplitInBatches loop  
* IF node  
* OpenAI interaction  
* Trello node  
* Merge node  
* Slack node  
* Error workflow

### 3.1 Workflow JSON

Below is a fully runnable export. (Replace credential names with yours.)

```json
{
  "name": "GH Bug → Trello + Slack with AI sentiment",
  "active": true,
  "settings": {
    "timezone": "Europe/Berlin",
    "errorWorkflow": "Handle Workflow Error"
  },
  "nodes": [
    {
      "parameters": {
        "triggerTimes": {
          "item": [
            {
              "mode": "everyDay",
              "hour": 9,
              "minute": 0,
              "weekday": [
                "mon",
                "tue",
                "wed",
                "thu",
                "fri"
              ]
            }
          ]
        }
      },
      "id": "1",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [240, 300]
    },
    {
      "parameters": {
        "httpMethod": "GET",
        "url": "https://api.github.com/repos/{{ $env.GH_OWNER }}/{{ $env.GH_REPO }}/issues",
        "queryParametersUi": {
          "parameter": [
            { "name": "state", "value": "open" },
            { "name": "per_page", "value": "100" }
          ]
        },
        "responseFormat": "json",
        "splitIntoItems": true,
        "dataPropertyName": ""
      },
      "id": "2",
      "name": "GitHub Issues",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [480, 300],
      "credentials": {
        "httpBasicAuth": {
          "id": "github-token",
          "name": "GitHub Personal Access Token"
        }
      }
    },
    {
      "parameters": {
        "batchSize": 1,
        "options": {}
      },
      "id": "3",
      "name": "SplitInBatches",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 1,
      "position": [720, 300]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json[\"labels\"].map(l => l.name).join(',') }}",
              "operation": "contains",
              "value2": "bug"
            }
          ]
        }
      },
      "id": "4",
      "name": "IF bug label?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [960, 300]
    },
    {
      "parameters": {
        "model": "gpt-3.5-turbo",
        "messages": {
          "message": [
            {
              "role": "system",
              "content": "You are a helpful assistant summarising GitHub issues."
            },
            {
              "role": "user",
              "content": "Give me a sentiment score (-100 to 100) and one-line summary for this issue (JSON output with keys sentiment, summary):\n{{$json[\"title\"]}}\n{{$json[\"body\"]}}"
            }
          ]
        },
        "responseFormat": "jsonParse"
      },
      "id": "5",
      "name": "OpenAI Sentiment",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 2,
      "position": [1200, 150],
      "credentials": {
        "openAiApi": {
          "id": "openai-creds",
          "name": "OpenAI Account"
        }
      }
    },
    {
      "parameters": {
        "operation": "create",
        "boardId": "={{ $env.TRELLO_BOARD_ID }}",
        "listId": "={{ $env.TRELLO_LIST_ID }}",
        "name": "={{ $json[\"title\"] }}",
        "description": "={{ $json[\"body\"] }}\n\nSentiment: {{$node[\"OpenAI Sentiment\"].json[\"sentiment\"]}}"
      },
      "id": "6",
      "name": "Create Trello Card",
      "type": "n8n-nodes-base.trello",
      "typeVersion": 1,
      "position": [1440, 150],
      "credentials": {
        "trelloApi": {
          "id": "trello-creds",
          "name": "Trello API"
        }
      }
    },
    {
      "parameters": {
        "mode": "raw",
        "rawMessage": "New *bug* card created in Trello → {{$json[\"name\"]}}\n{{$json[\"shortUrl\"]}}\nSentiment: {{$node[\"OpenAI Sentiment\"].json[\"sentiment\"]}}"
      },
      "id": "7",
      "name": "Slack Notify",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 4,
      "position": [1680, 150],
      "credentials": {
        "slackApi": {
          "id": "slack-bot",
          "name": "Slack Bot"
        }
      }
    },
    {
      "parameters": {
        "setAllData": false,
        "values": {
          "string": [
            {
              "name": "error",
              "value": "={{ $json }}"
            }
          ]
        }
      },
      "id": "8",
      "name": "Prepare Error",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [960, 570]
    },
    {
      "parameters": {
        "mode": "raw",
        "rawMessage": ":warning: Workflow error:\n```{{$json[\"error\"]}}```"
      },
      "id": "9",
      "name": "Slack Error",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 4,
      "position": [1200, 570],
      "credentials": {
        "slackApi": {
          "id": "slack-bot",
          "name": "Slack Bot"
        }
      }
    }
  ],
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          { "node": "GitHub Issues", "type": "main", "index": 0 }
        ]
      ]
    },
    "GitHub Issues": {
      "main": [
        [
          { "node": "SplitInBatches", "type": "main", "index": 0 }
        ]
      ]
    },
    "SplitInBatches": {
      "main": [
        [
          { "node": "IF bug label?", "type": "main", "index": 0 }
        ]
      ]
    },
    "IF bug label?": {
      "main": [
        [
          { "node": "OpenAI Sentiment", "type": "main", "index": 0 }
        ],
        [
          { "node": "SplitInBatches", "type": "main", "index": 1 }
        ]
      ]
    },
    "OpenAI Sentiment": {
      "main": [
        [
          { "node": "Create Trello Card", "type": "main", "index": 0 }
        ]
      ]
    },
    "Create Trello Card": {
      "main": [
        [
          { "node": "Slack Notify", "type": "main", "index": 0 },
          { "node": "SplitInBatches", "type": "main", "index": 1 }
        ]
      ]
    },
    "Prepare Error": {
      "main": [
        [
          { "node": "Slack Error", "type": "main", "index": 0 }
        ]
      ]
    }
  }
}
```

### 3.2 Complementary “Error Workflow”

n8n lets you set a secondary workflow that triggers on any unhandled exception in the primary one.  
Export the following and name it “Handle Workflow Error” (its ID is referenced in the settings of the main workflow).

```json
{
  "name": "Handle Workflow Error",
  "active": false,
  "nodes": [
    {
      "parameters": {
        "stringToSplit": "={{ $json[\"execution\"][\"error\"] }}",
        "splitBy": "|||"
      },
      "id": "10",
      "name": "Error Payload",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [380, 300]
    }
  ],
  "connections": {}
}
```

(A minimal placeholder—you can enrich it later.)

---

## 4. Deep Dive: Node-by-Node Breakdown

Below we’ll dissect each node, show the raw JSON fields, UI screenshots (refer to docs), and customisation levers.

### 4.1 Schedule Trigger (Node 1)

Key parameters:

| Field | JSON Path | Explanation | Customisation Tips |
|-------|-----------|-------------|--------------------|
| Mode | `parameters.triggerTimes.item[].mode` | `everyDay`, `everyX`, `custom` cron, etc. | For irregular cadences use `cron` and set `cronExpression`. |
| Hour / Minute | `hour`, `minute` | 0–23, 0–59 | Combine with `weekday` array for business-days only. |
| Timezone | workflow-level `settings.timezone` | Applies to ALL date ops. | Always set explicitly to avoid confusion in multi-user teams. |

Useful docs:  
• docs.n8n.io/nodes/schedule-trigger/  
• CRON primer: crontab.guru

### 4.2 HTTP Request – GitHub Issues (Node 2)

Important points:

* **splitIntoItems=true** – each array element from the REST response becomes its own n8n item, enabling per-issue processing.  
* **Query parameters** are set via `queryParametersUi`. Equivalent raw string: `url` could contain `?state=open&per_page=100`.  
* **Auth** – we reference a credential (`github-token`). n8n injects the token in the header; you do NOT store secrets in the workflow JSON—only in the credential entity stored server side.

Customisations:

* Add `"onlyOutputs": "data"` to strip response headers.  
* Implement pagination by checking the `link` header and looping (see docs: docs.n8n.io/nodes/n8n-nodes-base.httpRequest/).

### 4.3 SplitInBatches (Node 3)

Allows iterative processing without loading thousands of items into memory.

| Parameter | Meaning |
|-----------|---------|
| `batchSize` | Items per loop. `1` → behave like a classic for-loop. |

Connections:

* The second output (index 1) returns to itself (`SplitInBatches`) forming a **do-while** pattern until items array is empty.

Docs: docs.n8n.io/nodes/split-in-batches/  
Tip: combine with `Wait` node to rate-limit third-party APIs.

### 4.4 IF Node (Node 4)

Evaluation uses [Expression Syntax](https://docs.n8n.io/code-expressions/):

```js
{{$json["labels"].map(l => l.name).join(',')}} contains 'bug'
```

Key fields:

* `conditions.string[]` – an array of compare objects (`value1`, `operation`, `value2`).  
* Outputs: `0` = **true**, `1` = **false**.

Customisation:

* Add extra AND/OR groups for severity, author, etc.  
* Use `logic` parameter (UI toggle) for “ALL” vs “ANY” when multiple conditions.

### 4.5 OpenAI (Node 5)

Parameters we set:

| Field | Value |
|-------|-------|
| `model` | `"gpt-3.5-turbo"` |
| `messages` | Array of chat roles. |
| `responseFormat` | `"jsonParse"` – n8n auto-parses JSON in the assistant message. |

Outputs:

```jsonc
{
  "sentiment": 42,
  "summary": "Crash when clicking Save on settings page."
}
```

Customisation:

* Use `temperature` (0-2) for creativity.  
* Rate limit with `Wait` node to avoid 429.  
* Attach logs for traceability (OpenAI returns usage tokens).

Docs: docs.n8n.io/integrations/ai/openai/

### 4.6 Trello (Node 6)

Auto-detects board & list names if credentials are valid.

Parameters:

| JSON Key | Example |
|----------|---------|
| `boardId` | Env variable pulled via expression. |
| `listId`  | Ditto. |
| `name`    | Issue title. |
| `description` | Combined body + sentiment. |

Tips:

* Add labels by toggling “Additional Fields” → `labels`.  
* Attach GitHub issue URL for quick context.

### 4.7 Slack Notify (Node 7)

Using “Raw text” avoids the blocks builder overhead.

* Slack formatting: `*bold*, _italic_, <https://url|link>`.  
* Map dynamic fields from any previous node via `$node["OpenAI Sentiment"].json`.

Advanced:

* Switch `mode` to `blockKit` for rich interactive cards.

Docs & examples: docs.n8n.io/integrations/chat/slack/

### 4.8 Error Path (Nodes 8-9)

When any unhandled exception occurs, n8n spins a new execution of the **error workflow**, injecting an `execution` object (stack, node, message). We capture it with a `Set` → Slack.

---

## 5. Workflow-Level Settings

Open “Workflow → Settings”:

| Key | Description |
|-----|-------------|
| **timezone** | Already showcased. |
| **saveManualExecutions** | Persist data when running in “Manual” mode (good for debugging). |
| **errorWorkflow** | Points to “Handle Workflow Error”. |
| **retryOnFail** | Turn on auto-retries; adjust `maxTries`, `waitBetweenTries` per node. |
| **pinData** | Developer only; pinned test data gets stored in JSON under `pinData`. Remove before prod to keep file clean. |

Documentation: docs.n8n.io/workflows/settings/

---

## 6. Customisation Playbook

Below are practical tweaks to adapt the example for your own org.

### 6.1 Changing the Data Source

Replace “GitHub Issues” with:

* **Jira Software** (node: `n8n-nodes-base.jiraSoftware`).  
  – Query JQL: `project=myPRJ AND status=Open`.  
* **Azure DevOps Work Items**.  
* **ServiceNow Incidents**.

### 6.2 Alternative AI Providers

Swap `OpenAI` for:

* **Cohere** (node: `cohereAi`).  
* **Hugging Face Inference** (HTTP POST to hosted model).  
* **Self-hosted sentiment on FastAPI**.

### 6.3 Branching Logic

* Add a second IF that tests `sentiment < -30` → route urgent items to PagerDuty.  
* Use `Switch` node for multi-case branching: “bug”, “enhancement”, “question”.

### 6.4 Loop Optimisations

* Increase `batchSize` to 10 and wrap downstream requests in `Wait 1s` to stay within GitHub rate limit.  
* Remove `SplitInBatches` if using GitHub GraphQL (single payload of 1 000 issues).

### 6.5 Env Variables

n8n supports `${VARIABLE}` in UI fields or `{{$env.VARIABLE}}` in expressions.  
Store board IDs, tokens, channel IDs as env vars and keep workflow JSON secret-free.

---

## 7. Reference Library

Below is a curated selection of docs, templates and videos. All links active as of June 2024.

### 7.1 Official Documentation

| Topic | URL |
|-------|-----|
| Node Reference | https://docs.n8n.io/nodes/ |
| Expression Syntax | https://docs.n8n.io/code-expressions/ |
| Error Handling | https://docs.n8n.io/workflows/error-handling/ |
| Credentials & Secrets | https://docs.n8n.io/security/credentials/ |
| Environment Variables | https://docs.n8n.io/hosting/environment-variables/ |

### 7.2 Community Workflow Templates

| Template | Highlights |
|----------|------------|
| GitHub PR → Slack | https://n8n.io/workflows/1538 |
| Notion database backup | https://n8n.io/workflows/820 |
| RSS to Twitter thread | https://n8n.io/workflows/2265 |

Browse all at https://n8n.io/workflows and sort by “Most Popular”.

### 7.3 YouTube Playlists

| Channel | Video / Playlist | Key Take-away |
|---------|------------------|--------------|
| n8n Official | “n8n 101” series | 15 short clips covering expressions, error workflows, credentials. |
| Josh Burns Tech | “Building complex automations with n8n” | Hands-on demos, esp. GitHub integration. |
| Coding in Public | “Automate Anything with n8n & GPT-4” | Practical AI workflows. |

Tip: set playback to 1.25× speed and pause when replicating steps in your instance.

### 7.4 Blogs & Articles

* “Mastering n8n Expressions” – https://medium.com/@docuowl/mastering-n8n-expressions  
* “Self-hosting n8n with docker-compose in production” – https://mindsers.blog/post/n8n-production-docker/  
* “Design Patterns for Reliable Automations” – https://docs.n8n.io/best-practices/

---

## 8. Best Practices Checklist

1. **One purpose per workflow** – easier to reason about, test and roll back.  
2. **Fail fast** – validate inputs early with IF/Set + Throw Error node.  
3. **Externalise secrets** – env vars & credential manager, never hard-code.  
4. **Source control** – store JSON in Git, commit often, use tags for releases.  
5. **Document with Notes** – each node supports rich-text comments. Future-you will thank you.  
6. **Use sub-workflows** – call other workflows via “Execute Workflow” node; promotes reuse.  
7. **Monitor executions** – enable Prometheus metrics or forward logs to Grafana/Loki.

---

## 9. Troubleshooting & Validation

| Symptom | Likely Cause | Fix |
|---------|--------------|-----|
| HTTP 403 from GitHub | Token lacks `repo` scope | Edit PAT scopes. |
| OpenAI 429 errors | Rate limit | Insert `Wait` or upgrade plan. |
| Slack duplicate messages | Loop not exiting | Check `SplitInBatches` second output. |
| “Cannot find credentials” after import | IDs differ between instances | Re-attach credentials via UI, then export again so IDs match. |

### Dry-Run Technique

1. Disable (`⌘/Ctrl + E`) all “side-effect” nodes (Trello, Slack).  
2. Run workflow manually; inspect data.  
3. Re-enable nodes after verification.

---

## 10. Conclusion & Next Steps

You now possess:

* A functioning multi-service workflow with AI enrichment, error handling, looping and messaging.  
* A mental model of the n8n JSON schema and how every knob maps to visual UI.  
* A library of links to continue levelling up.

Recommended challenges:

1. Add caching: store processed GitHub issue IDs in a PostgreSQL table via the Database node and skip repeats.  
2. Package workflows as “npm” for the upcoming n8n-packages feature.  
3. Contribute a template back to https://n8n.io/workflows – open source ❤️.
